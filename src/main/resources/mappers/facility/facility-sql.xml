<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="facility">
	<select id="selectFacilityList" parameterType="hmap" resultType="Facility">
		SELECT
			FACILITY.*
			, CONSTRUCTION_NAME
			, CATEGORY_NAME
		FROM EO_FACILITY FACILITY
		JOIN EO_CONSTRUCTION_TYPE USING (CONSTRUCTION_CODE)
		JOIN EO_CATEGORY USING (CATEGORY_CODE)
		<where>
			<if test="@com.jeo.common.util.CommonUtils@isNotEmpty(keyword)">
				AND (FACILITY_TAG_NO LIKE CONCAT('%', #{keyword}, '%') OR FACILITY_NAME LIKE CONCAT('%', #{keyword}, '%'))
			</if>
			<if test="@com.jeo.common.util.CommonUtils@isNotEmpty(facility_tag_no_keyword)">
				AND FACILITY_TAG_NO LIKE CONCAT('%', #{facility_tag_no_keyword}, '%')
			</if>
			<if test="@com.jeo.common.util.CommonUtils@isNotEmpty(facility_name_keyword)">
				AND FACILITY_NAME LIKE CONCAT('%', #{facility_name_keyword}, '%')
			</if>
			<if test="@com.jeo.common.util.CommonUtils@isNotEmpty(construction_code)">
				AND CONSTRUCTION_CODE = #{construction_code}
			</if>
			<if test="@com.jeo.common.util.CommonUtils@isNotEmpty(category_code)">
				AND CATEGORY_CODE = #{category_code}
			</if>
			<if test="@com.jeo.common.util.CommonUtils@isNotEmpty(start_date)">
				AND MAJOR_REPAIRCOMPLETION_DATE >= #{start_date}
			</if>
			<if test="@com.jeo.common.util.CommonUtils@isNotEmpty(end_date)">
				AND MAJOR_REPAIRCOMPLETION_DATE <![CDATA[<=]]> #{end_date}
			</if>
		</where>
		ORDER BY FACILITY_TAG_NO
	</select>

	<select id="select" parameterType="String" resultType="Facility">
		SELECT
			FACILITY.*
			 , CONSTRUCTION_NAME
			 , CATEGORY_NAME
		FROM EO_FACILITY FACILITY
				 JOIN EO_CONSTRUCTION_TYPE USING (CONSTRUCTION_CODE)
				 JOIN EO_CATEGORY USING (CATEGORY_CODE)
		WHERE FACILITY_TAG_NO = #{facility_tag_no}
	</select>

	<insert id="insert" parameterType="Facility">
		INSERT INTO EO_FACILITY (
			FACILITY_TAG_NO
			, FACILITY_NAME
			, CONSTRUCTION_CODE
			, CATEGORY_CODE
			, FACILITY_QUANTITY
			, PURCHASE_PRICE
			, EMPLACEMENT
			, PRODUCTION_COMPANY
			, FORM
			, INSTALLER
			, SPECIFICATION
			, INSTALLATION_PURPOSE
			, MANUFACTURE_DATE
			, COMPLETION_DATE
			, DURABLE
			, MAJOR_REPAIRCOMPLETION_DATE
			, MAJOR_REPAIR_CONTENT
			, MAJOR_REPAIR_INSTALLER
			, FACILITY_REG_DATE
			, FACILITY_MOD_DATE
			, FACILITY_MOD_USER
			, ELECTRIC_MOTOR_FORM
			, ELECTRIC_MOTOR_RPM
			, ELECTRIC_MOTOR_PRODUCTION_COMPANY
			, ELECTRIC_MOTOR_VOLUME
			, ELECTRIC_MOTOR_STARTING_METHOD
			, ELECTRIC_MOTOR_POWER
			, ELECTRIC_MOTOR_PRODUCTION_DATE
			, MOTOR_BEARING_NO_1
			, MOTOR_BEARING_NO_2
			, PUMP_REDUCER_BEARING_NO_1
			, PUMP_REDUCER_BEARING_NO_2
			, FACILITY_IMAGE_PATH
		) VALUES (
			#{facility_tag_no}
			, #{facility_name}
			, #{construction_code}
			, #{category_code}
			, #{facility_quantity}
			, #{purchase_price}
			, #{emplacement}
			, #{production_company}
			, #{form}
			, #{installer}
			, #{specification}
			, #{installation_purpose}
			, #{manufacture_date}
			, #{completion_date}
			, #{durable}
			, #{major_repaircompletion_date}
			, #{major_repair_content}
			, #{major_repair_installer}
			, NOW()
			, NOW()
			, #{facility_mod_user}
			, #{electric_motor_form}
			, #{electric_motor_rpm}
			, #{electric_motor_production_company}
			, #{electric_motor_volume}
			, #{electric_motor_starting_method}
			, #{electric_motor_power}
			, #{electric_motor_production_date}
			, #{motor_bearing_no_1}
			, #{motor_bearing_no_2}
			, #{pump_reducer_bearing_no_1}
			, #{pump_reducer_bearing_no_2}
			, #{facility_image_path}
		)
	</insert>

	<update id="update" parameterType="Facility">
		UPDATE EO_FACILITY
		SET
			FACILITY_NAME = #{facility_name}
			, CONSTRUCTION_CODE = #{construction_code}
			, CATEGORY_CODE = #{category_code}
			, FACILITY_QUANTITY = #{facility_quantity}
			, PURCHASE_PRICE = #{purchase_price}
			, EMPLACEMENT = #{emplacement}
			, PRODUCTION_COMPANY = #{production_company}
			, FORM = #{form}
			, INSTALLER = #{installer}
			, SPECIFICATION = #{specification}
			, INSTALLATION_PURPOSE = #{installation_purpose}
			, MANUFACTURE_DATE = #{manufacture_date}
			, COMPLETION_DATE = #{completion_date}
			, DURABLE = #{durable}
			, MAJOR_REPAIRCOMPLETION_DATE = #{major_repaircompletion_date}
			, MAJOR_REPAIR_CONTENT = #{major_repair_content}
			, MAJOR_REPAIR_INSTALLER = #{major_repair_installer}
			, FACILITY_MOD_DATE = NOW()
			, FACILITY_MOD_USER = #{facility_mod_user}
			, ELECTRIC_MOTOR_FORM = #{electric_motor_form}
			, ELECTRIC_MOTOR_RPM = #{electric_motor_rpm}
			, ELECTRIC_MOTOR_PRODUCTION_COMPANY = #{electric_motor_production_company}
			, ELECTRIC_MOTOR_VOLUME = #{electric_motor_volume}
			, ELECTRIC_MOTOR_STARTING_METHOD = #{electric_motor_starting_method}
			, ELECTRIC_MOTOR_POWER = #{electric_motor_power}
			, ELECTRIC_MOTOR_PRODUCTION_DATE = #{electric_motor_production_date}
			, MOTOR_BEARING_NO_1 = #{motor_bearing_no_1}
			, MOTOR_BEARING_NO_2 = #{motor_bearing_no_2}
			, PUMP_REDUCER_BEARING_NO_1 = #{pump_reducer_bearing_no_1}
			, PUMP_REDUCER_BEARING_NO_2 = #{pump_reducer_bearing_no_2}
			, FACILITY_IMAGE_PATH = #{facility_image_path}
		WHERE FACILITY_TAG_NO = #{facility_tag_no}
	</update>

	<select id="findFacilitiesByKeywordInTagNoOrName" parameterType="String" resultType="Facility">
		SELECT *
		FROM EO_FACILITY
		WHERE FACILITY_TAG_NO LIKE CONCAT('%', #{keyword}, '%')
		   OR FACILITY_NAME LIKE CONCAT('%', #{keyword}, '%')
		ORDER BY FACILITY_TAG_NO
	</select>
</mapper>

